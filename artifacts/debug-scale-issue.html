<!DOCTYPE html>
<html>
<head>
    <title>Scale Issue Debug</title>
    <style>
        body { font-family: system-ui; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .value { font-weight: bold; color: #0066cc; }
        button { padding: 8px 16px; margin: 5px; }
        input { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h2>Scale Issue Debug Tool</h2>

    <div class="debug-section">
        <h3>Test Controls</h3>
        <button onclick="openMainApp()">Open Main App</button>
        <button onclick="testScale92()">Test Scale 92%</button>
        <button onclick="refreshData()">Refresh Data</button>
    </div>

    <div class="debug-section">
        <h3>Current Values</h3>
        <div id="debugOutput">Click "Refresh Data" to see current values</div>
    </div>

    <script>
        function openMainApp() {
            window.open('index.html', '_blank');
        }

        async function testScale92() {
            const result = await fetch('index.html')
                .then(() => console.log('App should be running in another tab'))
                .catch(() => console.log('Could not fetch app'));

            alert('Open the main app in another tab, set scale to 92%, then click "Refresh Data" here');
        }

        function refreshData() {
            // This is a simple debug helper
            // You would manually input the values you see in the main app
            const scaleValue = prompt('What does the Scale input show?', '92');
            const mkPercent = prompt('What does the MK row percentage show?', '92.0');
            const chartLabel = prompt('What does the MK ink label on the chart show?', '85');

            document.getElementById('debugOutput').innerHTML = `
                <p><strong>Scale Input:</strong> <span class="value">${scaleValue}%</span></p>
                <p><strong>MK Row Percentage:</strong> <span class="value">${mkPercent}%</span></p>
                <p><strong>Chart Ink Label:</strong> <span class="value">${chartLabel}%</span></p>
                <p><strong>Expected Behavior:</strong> All three should match at <span class="value">92%</span></p>
                <p><strong>Issue:</strong> ${chartLabel === '92' ? 'None - values match!' : 'Chart label differs from UI values'}</p>

                <h4>Possible Causes:</h4>
                <ul>
                    <li>Chart not refreshing after scale change</li>
                    <li>Linearization or correction being applied unexpectedly</li>
                    <li>Cached baseline values causing confusion</li>
                    <li>Peak value calculation using old curve data</li>
                </ul>

                <h4>Debug Steps:</h4>
                <ol>
                    <li>Try setting scale to 100%, then back to 92%</li>
                    <li>Check if any linearization data is loaded</li>
                    <li>Try refreshing the page and setting scale again</li>
                    <li>Check browser console for any errors</li>
                </ol>
            `;
        }
    </script>
</body>
</html>